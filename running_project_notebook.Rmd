---
title: "R Notebook"
output: html_notebook
---

I'd like to see if there are any patterns in my running pace and if so use them to make predictions about my pace in future runs. I have about five years of running data stored in Strava, so I exported this data, deleted some irrelevant, redundant, or personal columns, and will import and clean it up here.

```{r setup}

#Let's start by loading necessary packages

library(tidyverse)
library(lubridate)

# Import the dataset

activities <- read_csv("activities.csv",
                       col_types = cols(
  `Activity ID` = col_double(),
  `Activity Date` = col_character(),
  `Activity Name` = col_character(),
  `Activity Type` = col_character(),
  `Elapsed Time` = col_double(),
  Distance = col_double(),
  Commute = col_logical(),
  `Moving Time` = col_double(),
  `Max Speed` = col_double(),
  `Elevation Gain` = col_double(),
  `Elevation Loss` = col_double(),
  `Elevation Low` = col_double(),
  `Elevation High` = col_double(),
  `Max Grade` = col_double(),
  `Average Grade` = col_double()
                                )
                       )

# I'm only intersted in running for now, so I'm going to filter out any other activities (which I haven't recorded as consistently)

activities <- activities %>%
        filter(`Activity Type` == "Run") %>%
        mutate(date = as_date(mdy_hms(`Activity Date`)))

```

```{r head_and_tail}
head(activities)

tail(activities)
```

So we're left with 708 runs recorded betwwn July 17, 2015 and June 19, 2020. Some of the columns that might contribute to my speed include "Activity Date" (how old I was), "Distance," and "Elevation Gain." I could also estimate how well trained I was at any particular moment (say, how much I had run in the previous twelve weeks), and my recovery status (say, how much I had run in the previous two days). 

Let's start by looking at my pace over time to see if any patterns leap out.

```{r pace}

# Calculate pace and plot changes over time
# "Distance" is in km and "Moving Time" is in seconds
# So we get a pace of seconds / km

activities <- activities %>%
        mutate(pace = `Moving Time` / Distance)

ggplot(activities, mapping = aes(x = date, y = pace)) +
        geom_point()

```

I wonder what's going on with the outliers where I'm much faster or slower than usual

```{r slow}
activities %>%
        filter(pace > 450)
```

The slowest run is a trail run with a big elevation gain, so we should be able to account for it with regression analysis later on. The second slowest run I was accompanying my child on a fun run, so it doesn't indicate my own efforts. I never go on a runs that short, so I can probably eliminate some uncharacteristic data by removing distances of less than two kilometers without losing any useful data.

```{r fast}
activities %>%
        filter(pace < 300)
```

At least two of the fast runs are races, but one of them looks like a misclassified bike ride. I don't think I can run that fast! Let's remove it from the data set and replot the data.

```{r filter}
activities <- activities %>%
        filter(pace > 200) %>%
        filter(Distance > 2)
        
        ggplot(activities, mapping = aes(x = date, y = pace)) +
        geom_point()
```

It does look like I might be getting slightly slower over time. Is it aging or something else? Let's fit a model to the data to see what we're working with.

```{r date_model}
mod_date <- lm(pace ~ date, activities)
mod_date
anova(mod_date)
ggplot(activities, mapping = aes(x = date, y = pace)) +
        geom_point() +
        geom_abline(slope = 0.03355, intercept = -211.19030)
```
I've definitely been getting slower over the past five years, but is it just the passage of time or are their other explanations?

Distance seems like it would be an important factor for pace. Let's take a look:

```{r distance_model}

mod_distance <- lm(pace ~ Distance, activities)
mod_distance
anova(mod_distance)
ggplot(activities, mapping = aes(x = Distance, y = pace)) +
        geom_point() +
        geom_abline(slope = 0.5395, intercept = 373.0588)

```
Distance certainly makes a difference, but not as much as I might have thought. The three longest runs are marathons, which means I was well-trained and ready to race.

Let's consider elevation gain:
```{r elevation_model}

mod_elevation <- lm(pace ~ `Elevation Gain`, activities)
mod_elevation
anova(mod_elevation)
ggplot(activities, mapping = aes(x = `Elevation Gain`, y = pace)) +
        geom_point() +
        geom_abline(slope = 0.1613, intercept = 361.6337)

```
It looks like elevation makes a difference.




